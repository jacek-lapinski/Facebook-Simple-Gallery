function facebookGallery(a){new FSG(a)}var FSG=function(){function a(a){this.config=a,this.setDefaults(),this.init()}return a.prototype.setDefaults=function(){if(void 0==this.config.imagesCountLimit&&(this.config.imagesCountLimit=100),void 0==this.config.wookmarkOptions){var a={autoResize:!0,offset:10,itemWidth:200,flexibleWidth:400,outerOffset:10};this.config.wookmarkOptions=a}this.config.includeAlbums&&this.convertStringArrayToLowerCase(this.config.includeAlbums),this.config.excludeAlbums&&this.convertStringArrayToLowerCase(this.config.excludeAlbums)},a.prototype.convertStringArrayToLowerCase=function(a){for(var b=0;b<a.length;b++)a[b]=a[b].toLocaleLowerCase()},a.prototype.init=function(){this.initFbScript(document,"facebook-jssdk"),this.initFb(window)},a.prototype.initFb=function(a){var b=this;a.fbAsyncInit=function(){FB.init({appId:b.config.appId,xfbml:!0,version:"v2.8"}),b.loadAlbums(b.config.elementId)}},a.prototype.initFbScript=function(a,b){if(!a.getElementById(b)){var c=a.getElementsByTagName("script")[0],d=a.createElement("script");d.id=b,d.src="http://connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(d,c)}},a.prototype.loadAlbums=function(a){var b=this,c=new AlbumsLoader(this.config),d=c.loadAlbums(),e=document.getElementById(a),f=document.createElement("ul");f.className="fsg-albums",e.appendChild(f),d.then(function(a){a.forEach(function(a){var c=b.createAlbumElement(a);f.appendChild(c)})})},a.prototype.initWookmark=function(){new Wookmark(".fsg-albums",this.config.wookmarkOptions)},a.prototype.createAlbumElement=function(a){var b=this,c=document.createElement("img");c.src=a.picture,c.onload=function(){return b.initWookmark()};var d=document.createElement("div");d.className="fsg-album-count-wrapper";var e=document.createElement("div");e.className="fsg-album-count-box";var f=document.createElement("div");f.className="fsg-album-count",f.innerText=a.count>this.config.imagesCountLimit?this.config.imagesCountLimit.toString():a.count.toString(),e.appendChild(f),d.appendChild(e);var g=document.createElement("div");g.className="fsg-album-title",g.innerText=a.name;var h=document.createElement("div");h.appendChild(c),h.appendChild(d),h.appendChild(g);var i=document.createElement("div");i.id=this.getImagesId(a);var j=document.createElement("li");return j.className="fsg-album",j.appendChild(h),j.appendChild(i),h.onclick=function(c){var d=b.getAlbumImagesElement(a);0==d.childNodes.length?b.loadAlbumImages(a):b.showAlbum(a)},j},a.prototype.getAlbumImagesElement=function(a){var b=this.getImagesId(a),c=document.getElementById(b);return c},a.prototype.getImagesId=function(a){return"images-"+a.id},a.prototype.getImageId=function(a){return"image-"+a.id},a.prototype.loadAlbumImages=function(a){var b=this,c=this.getAlbumImagesElement(a);a.images.then(function(d){d.forEach(function(b){var d=document.createElement("a");d.href=b.picture,d.setAttribute("data-lightbox",a.id),c.appendChild(d)}),b.showAlbum(a)})},a.prototype.showAlbum=function(a){var b=this.getAlbumImagesElement(a);if(b.children.length>0){var c=b.children[0];c.click()}},a}(),AlbumsLoader=function(){function a(a){this.config=a}return a.prototype.loadAlbums=function(){var a=this;return new Promise(function(b,c){FB.api("/"+a.config.fbPage+"/albums?limit=100&fields=created_time,name,id,count,picture{url},link,photos{images}",{access_token:a.config.accessToken},function(c){var d=c.data,e=[];if(void 0==a.config.excludeAlbums&&void 0==a.config.includeAlbums)for(var f=0;f<d.length;f++)d[f].count>0&&(d[f].picture=c.data[f].picture.data.url,d[f].images=a.loadAlbumImages(d[f]),e.push(d[f]));else if(a.config.includeAlbums)for(var f=0;f<d.length;f++)d[f].count>0&&a.arrayContains(a.config.includeAlbums,d[f].name)&&(d[f].picture=c.data[f].picture.data.url,d[f].images=a.loadAlbumImages(d[f]),e.push(d[f]));else for(var f=0;f<d.length;f++)d[f].count>0&&!a.arrayContains(a.config.excludeAlbums,d[f].name)&&(d[f].picture=c.data[f].picture.data.url,d[f].images=a.loadAlbumImages(d[f]),e.push(d[f]));b(e)})})},a.prototype.arrayContains=function(a,b){return a.indexOf(b.toLowerCase())>=0},a.prototype.loadAlbumImages=function(a){var b=this;return new Promise(function(c,d){FB.api("/"+a.id+"?fields=photos.limit(100){images}",{access_token:b.config.accessToken},function(d){var e=a.count>0?b.getImagesForAlbum(d.photos.data):[];c(e)})})},a.prototype.getImagesForAlbum=function(a){for(var b=[],c=0;c<a.length;c++){var d={id:a[c].id,picture:a[c].images[0].source};b.push(d)}return b},a}();